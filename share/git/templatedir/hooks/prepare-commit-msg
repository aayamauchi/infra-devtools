#!/bin/bash

unset branch

if [ "${2}" == merge ] ; then
    branch=$( sed -ne "1 {s/^[^']*'\([^']*\)'.*\$/\1/;p;}" "${1}" )
    # The branch name is not needed in the message body.
    sed -i -e "1 s/'[^']*'[[:space:]]*//" "${1}"
else
    branch=$( git symbolic-ref --short HEAD )
fi

ticket_type=$( echo ${branch} | sed -e 's/^\([[:alpha:]]*\).*/\U\1/' )

case "${ticket_type}" in
INFRA|RELEASE)
    sed -i -e "1 s/^/${ticket_type}-: /;" "${1}"
    ;;
*)
    sed -i -e '1 s/^/UNRECOGNIZED TICKET TYPE!/;' "${1}"
    exit 1
    ;;
esac
