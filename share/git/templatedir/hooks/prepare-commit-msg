#!/bin/bash

unset branch

if [ "${2}" == merge ] ; then
    branch=$( sed -ne "1 {s/^[^']*'\([^']*\)'.*\$/\1/;p;}" "${1}" )
    # The branch name is not needed in the message body.
    sed -i -e "1 s/'[^']*'[[:space:]]*//" "${1}"
else
    branch=$( git symbolic-ref --short HEAD )
fi

ticket=$( echo ${branch} | sed -e 's/\([[:alpha:]]*\)\([[:digit:]]*\)/\U\1-\2/g' )

case "${ticket%%-*}" in
INFRA|RELEASE)
    sed -i -e "1 s/^/${ticket}: /;" "${1}"
    ;;
*)
    sed -i -e '1 s/^/UNRECOGNIZED TICKET TYPE!/;' "${1}"
    ;;
esac
